---
// Page es-inscription - Esprit Subconscient
import GAConsentMode from '../components/GAConsentMode.astro';
---

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Esprit Subconscient - Reprogramme ton Subconscient en 21 Jours</title>
    <meta name="description" content="D√©couvre comment reprogrammer ton subconscient et transformer ta vie en 21 jours. Lib√®re-toi de tes blocages inconscients.">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    
    <!-- GA4 Consent Mode v2 -->
    <GAConsentMode />
    
    <!-- intl-tel-input CSS + JS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/intl-tel-input@18.5.3/build/css/intlTelInput.css">
    <script src="https://cdn.jsdelivr.net/npm/intl-tel-input@18.5.3/build/js/intlTelInput.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #3b82f6;
            --primary-light: #60a5fa;
            --primary-dark: #2563eb;
            --accent: #93c5fd;
            --bg-dark: #0a0a1a;
            --bg-card: rgba(59, 130, 246, 0.08);
            --text-white: #ffffff;
            --text-muted: rgba(255, 255, 255, 0.7);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-dark);
            color: var(--text-white);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Background */
        .bg-gradient {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(ellipse at 20% 0%, rgba(59, 130, 246, 0.3) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 100%, rgba(37, 99, 235, 0.2) 0%, transparent 50%),
                linear-gradient(180deg, #0a0a1a 0%, #1a1a3a 50%, #0a0a1a 100%);
            z-index: -1;
        }

        /* Container */
        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 60px 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        /* Hero Section */
        .hero {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 60px;
            align-items: center;
        }

        .hero-content {
            animation: fadeInUp 0.8s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid rgba(59, 130, 246, 0.4);
            border-radius: 50px;
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--accent);
            margin-bottom: 24px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .badge svg {
            width: 16px;
            height: 16px;
        }

        h1 {
            font-size: clamp(2rem, 4vw, 3rem);
            font-weight: 700;
            line-height: 1.2;
            margin-bottom: 24px;
            background: linear-gradient(135deg, #ffffff 0%, var(--accent) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subheadline {
            font-size: clamp(1rem, 2vw, 1.25rem);
            line-height: 1.7;
            color: var(--text-muted);
            margin-bottom: 40px;
        }

        .subheadline strong {
            color: var(--accent);
            font-weight: 600;
        }

        /* CTA Button */
        .cta-button {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            padding: 18px 40px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            font-size: 1.1rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 40px rgba(59, 130, 246, 0.4);
            position: relative;
            overflow: hidden;
        }

        .cta-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .cta-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 50px rgba(59, 130, 246, 0.6);
        }

        .cta-button:hover::before {
            left: 100%;
        }

        .cta-button svg {
            width: 20px;
            height: 20px;
        }

        /* Image Section */
        .hero-image {
            animation: fadeInRight 0.8s ease-out 0.2s both;
        }

        @keyframes fadeInRight {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .image-wrapper {
            position: relative;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 
                0 25px 80px rgba(59, 130, 246, 0.3),
                0 0 0 1px rgba(59, 130, 246, 0.2);
        }

        .image-wrapper::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 20px;
            padding: 2px;
            background: linear-gradient(135deg, var(--primary), transparent 50%);
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            pointer-events: none;
        }

        .hero-image img {
            width: 100%;
            height: auto;
            display: block;
        }

        /* Responsive */
        @media (max-width: 900px) {
            .hero {
                grid-template-columns: 1fr;
                gap: 40px;
                text-align: center;
            }

            .hero-image {
                order: -1;
                max-width: 400px;
                margin: 0 auto;
            }

            .cta-button {
                width: 100%;
                justify-content: center;
            }
        }

        /* ===== POPUP ===== */
        .custom-popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            z-index: 9999;
            animation: fadeIn 0.3s ease-out;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .popup-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #1a1a3a 0%, #0a0a1a 100%);
            border: 2px solid rgba(59, 130, 246, 0.4);
            border-radius: 24px;
            padding: 48px;
            max-width: 480px;
            width: 90%;
            box-shadow: 0 25px 80px rgba(59, 130, 246, 0.4);
            animation: slideIn 0.4s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translate(-50%, -60%);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%);
            }
        }

        .popup-close {
            position: absolute;
            top: 16px;
            right: 20px;
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 28px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .popup-close:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .popup-header {
            text-align: center;
            margin-bottom: 32px;
        }

        .popup-title {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #ffffff 0%, var(--accent) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .popup-subtitle {
            color: var(--text-muted);
            font-size: 1rem;
        }

        /* Form Inputs */
        .form-input {
            width: 100%;
            padding: 16px 20px;
            margin-bottom: 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-radius: 12px;
            color: white;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
        }

        .form-note {
            font-size: 0.8rem;
            color: var(--text-muted);
            text-align: center;
            margin: 12px 0 20px;
        }

        .form-note svg {
            width: 14px;
            height: 14px;
            vertical-align: middle;
            margin-right: 4px;
        }

        .submit-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 1rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.4);
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(59, 130, 246, 0.6);
        }

        .submit-btn.orange {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            box-shadow: 0 10px 30px rgba(245, 158, 11, 0.4);
        }

        .submit-btn.orange:hover {
            box-shadow: 0 15px 40px rgba(245, 158, 11, 0.6);
        }

        .step-title {
            text-align: center;
            color: white;
            font-size: 1.25rem;
            margin-bottom: 24px;
        }

        /* ===== INTL-TEL-INPUT - BLUE THEME ===== */
        
        /* Container */
        #phone-container .iti,
        .popup-content .iti,
        .iti {
            width: 100% !important;
        }
        
        /* INPUT TELEPHONE - STYLE DARK BLUE */
        #phone-container .iti input,
        #phone-container .iti input[type="tel"],
        #phone-container input#phone,
        .popup-content .iti input,
        .iti input,
        .iti input[type="tel"] {
            width: 100% !important;
            height: 56px !important;
            padding: 16px 16px 16px 115px !important;
            background: rgba(255, 255, 255, 0.05) !important;
            border: 2px solid rgba(59, 130, 246, 0.4) !important;
            border-radius: 12px !important;
            color: #ffffff !important;
            font-size: 16px !important;
            box-sizing: border-box !important;
            outline: none !important;
        }
        
        #phone-container .iti input:focus,
        .iti input:focus {
            border-color: var(--primary) !important;
            box-shadow: 0 0 25px rgba(59, 130, 246, 0.5) !important;
            background: rgba(255, 255, 255, 0.08) !important;
        }
        
        #phone-container .iti input::placeholder,
        .iti input::placeholder {
            color: rgba(255, 255, 255, 0.4) !important;
        }
        
        /* BOUTON DRAPEAU */
        #phone-container .iti__flag-container,
        .iti__flag-container {
            height: 100% !important;
        }
        
        #phone-container .iti__selected-flag,
        .popup-content .iti__selected-flag,
        .iti__selected-flag {
            height: 100% !important;
            padding: 0 14px !important;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.4) 0%, rgba(96, 165, 250, 0.3) 100%) !important;
            border-radius: 12px 0 0 12px !important;
            border-right: 2px solid rgba(59, 130, 246, 0.4) !important;
        }
        
        #phone-container .iti__selected-flag:hover,
        .iti__selected-flag:hover,
        .iti__selected-flag:focus {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.6) 0%, rgba(96, 165, 250, 0.5) 100%) !important;
        }
        
        /* Indicatif t√©l√©phonique */
        #phone-container .iti__selected-dial-code,
        .iti__selected-dial-code {
            color: #ffffff !important;
            font-size: 15px !important;
            font-weight: 600 !important;
            margin-left: 8px !important;
        }
        
        /* Fl√®che dropdown */
        #phone-container .iti__arrow,
        .iti__arrow {
            border-top: 6px solid #ffffff !important;
            border-left: 5px solid transparent !important;
            border-right: 5px solid transparent !important;
            margin-left: 8px !important;
        }
        
        .iti__arrow--up {
            border-top: none !important;
            border-bottom: 6px solid #ffffff !important;
        }

        /* ===== DROPDOWN LIST - AU DESSUS DU POPUP ===== */
        .iti--container {
            z-index: 9999999 !important;
        }
        
        body > .iti--container,
        .iti--container,
        .iti__country-list {
            z-index: 9999999 !important;
        }

        .iti__country-list {
            background: linear-gradient(180deg, #1a1a3a 0%, #0a0a1a 100%) !important;
            border: 2px solid rgba(59, 130, 246, 0.6) !important;
            border-radius: 14px !important;
            box-shadow: 
                0 25px 80px rgba(0, 0, 0, 0.95),
                0 0 60px rgba(59, 130, 246, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.1) !important;
            max-height: 250px !important;
            overflow-y: auto !important;
            margin-top: 5px !important;
        }

        .iti__country-list::-webkit-scrollbar {
            width: 10px;
        }

        .iti__country-list::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
        }

        .iti__country-list::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #3b82f6, #60a5fa);
            border-radius: 5px;
        }

        /* PAYS DANS LA LISTE */
        .iti__country {
            padding: 14px 18px !important;
            color: #ffffff !important;
            background: transparent !important;
            border-bottom: 1px solid rgba(59, 130, 246, 0.25) !important;
            transition: all 0.25s ease !important;
        }

        .iti__country:hover,
        .iti__country.iti__highlight {
            background: linear-gradient(90deg, rgba(59, 130, 246, 0.35) 0%, rgba(96, 165, 250, 0.25) 100%) !important;
        }

        .iti__country-name {
            color: #ffffff !important;
            font-weight: 400 !important;
        }

        .iti__dial-code {
            color: rgba(147, 197, 253, 0.9) !important;
            font-weight: 500 !important;
        }

        /* Pays pr√©f√©r√©s */
        .iti__country.iti__preferred {
            background: rgba(59, 130, 246, 0.2) !important;
        }

        .iti__divider {
            border-bottom: 2px solid rgba(59, 130, 246, 0.5) !important;
            margin: 0 !important;
            padding: 0 !important;
        }

        /* Mobile popup fix */
        @media (max-width: 768px) {
            .popup-content {
                position: relative;
                top: auto;
                left: auto;
                transform: none;
                margin: 40px auto;
                padding: 32px 24px;
            }
        }
    </style>
</head>
<body>
    <div class="bg-gradient"></div>
    
    <div class="container">
        <div class="hero">
            <div class="hero-content">
                <div class="badge">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                    </svg>
                    VID√âO GRATUITE
                </div>
                
                <h1>La Vraie Raison Pour Laquelle Tu N'atteins Pas Tes Objectifs</h1>
                
                <p class="subheadline">
                    Ce n'est pas un probl√®me d'action, c'est un probl√®me d'identit√©. Regarde cette vid√©o pour d√©couvrir pourquoi 98% des gens retombent toujours dans leurs vieilles habitudes ‚Äî et comment rejoindre les 2% qui en sortent.
                </p>
                
                <button class="cta-button popup-trigger">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M8 5v14l11-7z"/>
                    </svg>
                    REGARDER LA VID√âO
                </button>
            </div>
            
            <div class="hero-image">
                <div class="image-wrapper">
                    <img src="/media/pages/Sonny-Court-Manifest-Formation-2.webp" alt="Formation Esprit Subconscient - Sonny Court">
                </div>
            </div>
        </div>
    </div>

    <!-- Popup Optin -->
    <div id="custom-popup" class="custom-popup">
        <div class="popup-content">
            <button class="popup-close" id="popup-close-btn">&times;</button>
            
            <div class="popup-header">
                <h2 class="popup-title">Acc√®de √† la vid√©o gratuite</h2>
                <p class="popup-subtitle">Entre tes informations pour voir la vid√©o</p>
            </div>
            
            <!-- √âtape 1 -->
            <div id="step1-form">
                <input type="text" id="name" class="form-input" placeholder="Ton pr√©nom" required>
                <input type="email" id="email" class="form-input" placeholder="Ton email" required>
                
                <p class="form-note">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                        <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                    </svg>
                    Nous ne partagerons jamais tes informations
                </p>
                
                <button type="button" id="step1-button" class="submit-btn">Continuer</button>
            </div>

            <!-- √âtape 2 -->
            <div id="step2-form" style="display: none; text-align: center;">
                <h3 class="step-title">üéâ Derni√®re √©tape !</h3>
                
                <div id="phone-container" style="width: 100%; margin-bottom: 16px;"></div>
                <input type="hidden" id="phone_formatted" name="phone">
                
                <p class="form-note">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                        <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                    </svg>
                    Ton num√©ro est n√©cessaire pour acc√©der √† la vid√©o
                </p>
                
                <button type="button" id="step2-button" class="submit-btn orange">Voir la vid√©o maintenant</button>
            </div>
        </div>
    </div>

    <script>
        // ===== POPUP =====
        function openPopup() {
            document.getElementById('custom-popup').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function closePopup() {
            document.getElementById('custom-popup').style.display = 'none';
            document.body.style.overflow = '';
        }

        // ===== PHONE INPUT =====
        function initPhoneInput() {
            setTimeout(function() {
                const container = document.getElementById('phone-container');
                if (!container) return;
                
                container.innerHTML = '';
                
                const input = document.createElement('input');
                input.type = 'tel';
                input.id = 'phone';
                input.placeholder = 'Ton num√©ro';
                container.appendChild(input);
                
                if (typeof intlTelInput !== 'undefined') {
                    window.iti = intlTelInput(input, {
                        initialCountry: 'auto',
                        geoIpLookup: function(callback) {
                            fetch('https://ipapi.co/json/')
                                .then(res => res.json())
                                .then(data => callback(data.country_code))
                                .catch(() => callback('fr'));
                        },
                        preferredCountries: ['fr', 'ch', 'be', 'ca'],
                        separateDialCode: true,
                        utilsScript: 'https://cdn.jsdelivr.net/npm/intl-tel-input@18.5.3/build/js/utils.js',
                        dropdownContainer: document.body
                    });
                    
                    // Appliquer les styles via JavaScript
                    applyPhoneStyles();
                }
                
                console.log('Phone input initialis√© avec styles bleu');
            }, 100);
        }
        
        function applyPhoneStyles() {
            // Style de l'input
            const input = document.querySelector('#phone');
            if (input) {
                input.style.cssText = `
                    width: 100% !important;
                    height: 56px !important;
                    padding: 16px 16px 16px 115px !important;
                    background: rgba(255, 255, 255, 0.05) !important;
                    border: 2px solid rgba(59, 130, 246, 0.4) !important;
                    border-radius: 12px !important;
                    color: #ffffff !important;
                    font-size: 16px !important;
                    box-sizing: border-box !important;
                    outline: none !important;
                `;
            }
            
            // Style du bouton drapeau
            const flagBtn = document.querySelector('.iti__selected-flag');
            if (flagBtn) {
                flagBtn.style.cssText = `
                    height: 100% !important;
                    padding: 0 14px !important;
                    background: linear-gradient(135deg, rgba(59, 130, 246, 0.4) 0%, rgba(96, 165, 250, 0.3) 100%) !important;
                    border-radius: 12px 0 0 12px !important;
                    border-right: 2px solid rgba(59, 130, 246, 0.4) !important;
                `;
            }
            
            // Style de l'indicatif
            const dialCode = document.querySelector('.iti__selected-dial-code');
            if (dialCode) {
                dialCode.style.cssText = `
                    color: #ffffff !important;
                    font-size: 15px !important;
                    font-weight: 600 !important;
                    margin-left: 8px !important;
                `;
            }
            
            // Style de la fl√®che
            const arrow = document.querySelector('.iti__arrow');
            if (arrow) {
                arrow.style.cssText = `
                    border-top: 6px solid #ffffff !important;
                    border-left: 5px solid transparent !important;
                    border-right: 5px solid transparent !important;
                    margin-left: 8px !important;
                `;
            }
            
            // Injecter CSS pour le dropdown (qui est dans le body)
            if (!document.getElementById('phone-dropdown-styles')) {
                const styleTag = document.createElement('style');
                styleTag.id = 'phone-dropdown-styles';
                styleTag.textContent = `
                    .iti--container {
                        z-index: 9999999 !important;
                    }
                    .iti__country-list {
                        background: linear-gradient(180deg, #1a1a3a 0%, #0a0a1a 100%) !important;
                        border: 2px solid rgba(59, 130, 246, 0.7) !important;
                        border-radius: 14px !important;
                        box-shadow: 0 25px 80px rgba(0, 0, 0, 0.95), 0 0 60px rgba(59, 130, 246, 0.5) !important;
                        max-height: 250px !important;
                        overflow-y: auto !important;
                        z-index: 9999999 !important;
                    }
                    .iti__country {
                        padding: 14px 18px !important;
                        color: #ffffff !important;
                        background: transparent !important;
                        border-bottom: 1px solid rgba(59, 130, 246, 0.3) !important;
                    }
                    .iti__country:hover,
                    .iti__country.iti__highlight {
                        background: linear-gradient(90deg, rgba(59, 130, 246, 0.4), rgba(96, 165, 250, 0.3)) !important;
                    }
                    .iti__country-name {
                        color: #ffffff !important;
                    }
                    .iti__dial-code {
                        color: rgba(147, 197, 253, 0.9) !important;
                    }
                    .iti__divider {
                        border-bottom: 2px solid rgba(59, 130, 246, 0.5) !important;
                    }
                    .iti__country.iti__preferred {
                        background: rgba(59, 130, 246, 0.25) !important;
                    }
                `;
                document.head.appendChild(styleTag);
            }
        }

        // ===== LISTE NOIRE EMAILS JETABLES =====
        const DISPOSABLE_DOMAINS = [
            // Services populaires
            'tempmail.com', 'temp-mail.org', 'guerrillamail.com', 'guerrillamail.org',
            '10minutemail.com', '10minutemail.net', 'mailinator.com', 'yopmail.com',
            'throwaway.email', 'fakeinbox.com', 'trashmail.com', 'mailnesia.com',
            'getnada.com', 'sharklasers.com', 'spam4.me', 'grr.la', 'dispostable.com',
            'mohmal.com', 'tempail.com', 'emailondeck.com', 'mintemail.com',
            'temp-mail.io', 'tempmailo.com', 'tempmailaddress.com', 'emailfake.com',
            'crazymailing.com', 'mailcatch.com', 'mytemp.email', 'tmpmail.org',
            'tmpmail.net', 'dropmail.me', 'mailsac.com', 'maildrop.cc',
            'mailnator.com', 'inboxkitten.com', 'mail-temp.com', 'tempinbox.com',
            'fakemailgenerator.com', 'tempr.email', 'discard.email', 'mailpoof.com',
            // Services fran√ßais
            'jetable.org', 'yopmail.fr', 'yopmail.net', 'courriel.fr.nf',
            // Autres services courants
            'mailcatch.com', 'mailnull.com', 'e4ward.com', 'spamgourmet.com',
            'spambox.us', 'spamfree24.org', 'spamobox.com', 'trashmail.net',
            'wegwerfmail.de', 'wegwerfmail.net', 'wegwerfmail.org', 'getairmail.com',
            'mt2009.com', 'thankyou2010.com', 'trash2009.com', 'mt2014.com',
            'tempsky.com', 'tempmailgen.com', 'burnermail.io', 'mailforspam.com',
            'objectmail.com', 'proxymail.eu', 'rcpt.at', 'trash-mail.at',
            'explodemail.com', 'hmamail.com', 'mailexpire.com', 'nospam.ze.tc',
            'einrot.com', 'email-fake.com', 'fakeemail.de', 'fakeinformation.com',
            'guerrillamailblock.com', 'imgv.de', 'jetable.com', 'kasmail.com',
            'kurzepost.de', 'lhsdv.com', 'mailmoat.com', 'mailorc.com',
            'mailslite.com', 'mega.zik.dj', 'meltmail.com', 'moncourrier.fr.nf',
            'monemail.fr.nf', 'monmail.fr.nf', 'nomail.xl.cx', 'notsharingmy.info',
            'obobbo.com', 'one-time.email', 'online.ms', 'oopi.org',
            'pjjkp.com', 'privacy.net', 'privatdemail.net', 'punkass.com',
            'putthisinyourspamdatabase.com', 'quickinbox.com', 'rppkn.com', 'rtrtr.com',
            'safeemail.xyz', 'sharklasers.com', 'shieldedmail.com', 'shiftmail.com',
            'smellfear.com', 'sneakemail.com', 'sofimail.com', 'sogetthis.com',
            'soodonims.com', 'spamcero.com', 'spamcon.org', 'spamcorptastic.com',
            'spamday.com', 'spamex.com', 'spamfree.eu', 'spamherelots.com',
            'spaml.com', 'spaml.de', 'spamoff.de', 'spamslicer.com', 'spamspot.com',
            'superrito.com', 'suremail.info', 'tagyourself.com', 'teewars.org',
            'tempemail.biz', 'tempemail.com', 'tempinbox.co.uk', 'tempmail.eu',
            'tempmail2.com', 'tempmailer.com', 'tempmailer.de', 'tempomail.fr',
            'temporarioemail.com.br', 'temporaryemail.net', 'temporaryemail.us',
            'temporaryforwarding.com', 'temporaryinbox.com', 'thankyou2010.com',
            'thisisnotmyrealemail.com', 'throwam.com', 'throam.com', 'tilien.com',
            'tmailinator.com', 'toiea.com', 'tradermail.info', 'trash-amil.com',
            'trash2011.com', 'trash2012.com', 'trashdevil.com', 'trashdevil.de',
            'trashmail.ws', 'trashmail.de', 'trashmailer.com', 'trashymail.com',
            'trbvm.com', 'trbvn.com', 'trickmail.net', 'tyldd.com', 'uggsrock.com',
            'upliftnow.com', 'uplipht.com', 'venompen.com', 'veryrealemail.com',
            'viditag.com', 'viewcastmedia.com', 'viewcastmedia.net', 'viewcastmedia.org',
            'webm4il.info', 'wegwerfadresse.de', 'wetrainbayarea.com', 'wetrainbayarea.org',
            'wh4f.org', 'whatiaas.com', 'whopy.com', 'willselfdestruct.com',
            'winemaven.info', 'wronghead.com', 'wuzup.net', 'wuzupmail.net',
            'wwwnew.eu', 'xagloo.com', 'xemaps.com', 'xents.com', 'xmaily.com',
            'xoxy.net', 'yapped.net', 'yep.it', 'yogamaven.com', 'yopmail.gq',
            'yuurok.com', 'zehnminuten.de', 'zehnminutenmail.de', 'zippymail.info',
            'zoaxe.com', 'zoemail.org', 'zomg.info', 'zzz.com', '20minutemail.com',
            // Domaines temp-mail.org (changent souvent)
            'nctime.com', 'rteet.com', 'fexpost.com', 'labworld.org', 'dfrr.net',
            'inpwa.com', 'kixe.org', 'tafmail.com', 'emlpro.com', 'emlhub.com',
            'dcctb.com', 'tcwlm.com', 'knmcadibav.com', 'btcmod.com', 'jiooq.com',
            'tccq.org', 'cwmxc.com', 'freesourcecodes.com', 'zbock.com', 'qacmjeq.com',
            'greencafe24.com', 'by2s.com', 'cyclelove.cc', 'bestjv.com', 'vintomaper.com',
            'stvtp.com', 'seomail.org', 'hldrive.com', 'mailbox80.biz', 'firemailbox.club',
            'smartnator.com', 'totonb.com', 'psnator.com', '1mail.x24hr.com', 'gmailvn.net',
            'bgsaddrmwn.me', 'rfcdrive.com', 'dropsin.net', 'klovenode.com', 'zslsz.com'
        ];

        function isDisposableEmail(email) {
            const domain = email.toLowerCase().split('@')[1];
            if (!domain) return false;
            return DISPOSABLE_DOMAINS.includes(domain);
        }

        // ===== GESTION DES √âTAPES =====
        let currentEmail = '';
        let currentName = '';
        let userToken = '';

        // Fonction pour g√©n√©rer un token unique (UUID v4)
        function generateToken() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0;
                const v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        // Fonction pour r√©cup√©rer ou cr√©er le token
        function getOrCreateToken() {
            // V√©rifier si un token existe d√©j√† dans localStorage
            let token = localStorage.getItem('es_token');
            
            if (!token) {
                // G√©n√©rer un nouveau token
                token = generateToken();
                localStorage.setItem('es_token', token);
                // Stocker aussi dans un cookie pour persistance cross-device
                document.cookie = `es_token=${token}; path=/; max-age=${7 * 24 * 60 * 60}; SameSite=Lax`;
            }
            
            return token;
        }

        function handleStep1() {
            const name = document.getElementById('name').value.trim();
            const email = document.getElementById('email').value.trim();
            
            if (!name || !email) {
                alert('Merci de remplir tous les champs');
                return;
            }
            
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                alert('Merci d\'entrer un email valide');
                return;
            }
            
            // V√©rifier si l'email est jetable
            if (isDisposableEmail(email)) {
                alert('Merci d\'utiliser une adresse email personnelle pour recevoir ta vid√©o gratuite.');
                return;
            }
            
            currentName = name;
            currentEmail = email;
            
            // G√©n√©rer ou r√©cup√©rer le token
            userToken = getOrCreateToken();
            
            sendToMailerLite(name, email, userToken);
            
            document.getElementById('step1-form').style.display = 'none';
            document.getElementById('step2-form').style.display = 'block';
            
            initPhoneInput();
        }

        function handleStep2() {
            const phoneInput = document.getElementById('phone');
            
            if (!phoneInput || !phoneInput.value.trim()) {
                alert('Merci d\'entrer ton num√©ro de t√©l√©phone');
                if (phoneInput) phoneInput.focus();
                return;
            }
            
            let formattedPhone = phoneInput.value;
            
            if (window.iti) {
                try {
                    formattedPhone = window.iti.getNumber();
                } catch (e) {
                    formattedPhone = phoneInput.value;
                }
            }
            
            updateMailerLiteContact(currentName, currentEmail, formattedPhone, userToken);
        }

        // Group ID MailerLite pour ESPRIT SUBCONSCIENT
        const MAILERLITE_GROUP_ID = '173952883077678613';

        async function sendToMailerLite(name, email, token) {
            try {
                // Envoyer √† MailerLite avec le token
                const response = await fetch('/.netlify/functions/subscribe', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: email,
                        prenom: name,
                        groupId: MAILERLITE_GROUP_ID,
                        uniqueToken: token
                    })
                });
                const result = await response.json();
                if (response.ok) {
                    console.log('‚úÖ Contact ajout√©:', email);
                    
                    // Initialiser le countdown dans le backend
                    await initCountdown(token, email);
                } else {
                    console.error('‚ùå Erreur:', result);
                }
            } catch (error) {
                console.error('Erreur:', error);
            }
        }

        async function initCountdown(token, email) {
            try {
                console.log('üîÑ Initialisation countdown pour token:', token, 'email:', email);
                const response = await fetch('/.netlify/functions/init-countdown', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        token: token,
                        email: email
                    })
                });
                const result = await response.json();
                console.log('üì• R√©ponse init-countdown:', result, 'Status:', response.status);
                if (response.ok) {
                    console.log('‚úÖ Countdown initialis√© avec succ√®s:', token);
                } else {
                    console.error('‚ùå Erreur countdown:', result);
                    alert('Erreur lors de l\'initialisation du countdown. Veuillez r√©essayer.');
                }
            } catch (error) {
                console.error('‚ùå Erreur countdown (exception):', error);
                alert('Erreur de connexion lors de l\'initialisation du countdown.');
            }
        }

        async function updateMailerLiteContact(name, email, phone, token) {
            try {
                const response = await fetch('/.netlify/functions/subscribe', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: email,
                        prenom: name,
                        telephone: phone,
                        groupId: MAILERLITE_GROUP_ID,
                        uniqueToken: token
                    })
                });
                const result = await response.json();
                if (response.ok) {
                    console.log('‚úÖ Contact mis √† jour:', email, phone);
                }
                closePopup();
                redirectToVideo(token);
            } catch (error) {
                console.error('Erreur:', error);
                closePopup();
                redirectToVideo(token);
            }
        }

        function redirectToVideo(token) {
            // Passer le token dans l'URL
            window.location.href = `/es-video/?token=${token}`;
        }

        // ===== EVENT LISTENERS =====
        document.addEventListener('DOMContentLoaded', function() {
            // Boutons CTA
            document.querySelectorAll('.popup-trigger').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    openPopup();
                });
            });

            // Bouton de fermeture
            document.getElementById('popup-close-btn')?.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                closePopup();
            });

            // Boutons du formulaire
            document.getElementById('step1-button')?.addEventListener('click', handleStep1);
            document.getElementById('step2-button')?.addEventListener('click', handleStep2);

            // Fermer en cliquant √† l'ext√©rieur
            document.getElementById('custom-popup')?.addEventListener('click', function(e) {
                if (e.target === this) closePopup();
            });

            // Fermer avec √âchap
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') closePopup();
            });
        });
    </script>
</body>
</html>

