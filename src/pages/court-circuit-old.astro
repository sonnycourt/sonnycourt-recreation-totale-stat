---
import Layout from '../layouts/Layout.astro';
---

<Layout title="La NewsLetter court-circuit - Sonny Court" description="1 minute de lecture par email pour court-circuiter tes anciens sch√©mas. Mindset, Manifestation Haute performance & plus... Rejoins les +10 000 lecteurs du matin.">
  <div id="court-circuit-page">
    <!-- Background Effects -->
    <div class="background-effects">
      <div class="gradient-mesh"></div>
      <div class="depth-layers">
        <div class="depth-circle orb1"></div>
        <div class="depth-circle orb2"></div>
      </div>
      <div class="subconscious-particles">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
      </div>
    </div>

    <!-- Hero Section -->
    <section class="court-circuit-hero">
      <div class="hero-content">
        <div class="newsletter-badge">
          <span>La NewsLetter court-circuit</span>
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="zap-icon">
            <path d="M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z"/>
          </svg>
        </div>
        <h1>La premi√®re chose que tu lis <span class="highlight-blue">chaque matin</span> transforme <span class="highlight-blue">ta journ√©e</span>.</h1>
        <p class="hero-subtitle">
          Chaque matin, un email pour court-circuiter tes pens√©es limitantes.<br>
          Rejoins <span class="highlight">+<span id="counter">0</span></span> lecteurs.
        </p>
        <div class="badges-row">
          <span class="mini-badge">1 minute</span>
          <span class="mini-badge">1 id√©e</span>
          <span class="mini-badge">1 meme</span>
        </div>
      </div>
    </section>

    <!-- Main Content -->
    <section class="court-circuit-content">
      <div class="container">
        <div class="form-section">
          <h2>S'inscrire √† Court-Circuit</h2>
          <p class="form-description">Remplis le formulaire et re√ßois ton premier email maintenant</p>
          
          <form id="inscriptionForm" class="inscription-form">
            <div class="form-group">
              <label for="name">Pr√©nom *</label>
              <input 
                type="text" 
                id="name" 
                name="name" 
                required 
                placeholder="Ton pr√©nom"
              />
            </div>
            
            <div class="form-group">
              <label for="email">Email *</label>
              <input 
                type="email" 
                id="email" 
                name="email" 
                required 
                placeholder="ton@email.com"
              />
            </div>
            
            <button type="submit" class="submit-button">
              <span>Recevoir le premier email</span>
            </button>
            
            <div id="formMessage" class="form-message"></div>
          </form>
        </div>
      </div>
    </section>
  </div>
</Layout>

<style>
  #court-circuit-page {
    background: #0a0a0a;
    color: #ffffff;
    position: relative;
    overflow-x: hidden;
    min-height: 100vh;
  }

  /* Background Effects */
  .background-effects {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    min-height: 100%;
    z-index: 0;
    pointer-events: none;
    overflow: hidden;
  }

  /* S'assurer que le background couvre aussi le footer */
  :global(body) {
    background: #0a0a0a !important;
  }

  :global(html) {
    background: #0a0a0a !important;
  }

  .gradient-mesh {
    position: fixed;
    width: 200vw;
    height: 300vh;
    top: -50vh;
    left: -50vw;
    background: 
      radial-gradient(circle at 20% 30%, rgba(0, 122, 255, 0.15) 0%, transparent 60%),
      radial-gradient(circle at 80% 70%, rgba(0, 122, 255, 0.08) 0%, transparent 70%),
      radial-gradient(circle at 40% 20%, rgba(0, 122, 255, 0.05) 0%, transparent 80%),
      radial-gradient(circle at 60% 80%, rgba(0, 122, 255, 0.03) 0%, transparent 90%),
      radial-gradient(circle at 50% 150%, rgba(0, 122, 255, 0.08) 0%, transparent 60%),
      radial-gradient(circle at 30% 200%, rgba(0, 81, 213, 0.05) 0%, transparent 70%);
    filter: blur(60px);
    opacity: 0.7;
    animation: meshMove 40s ease-in-out infinite;
  }

  @keyframes meshMove {
    0%, 100% { transform: translate(0, 0) scale(1); }
    25% { transform: translate(-5%, -5%) scale(1.05); }
    50% { transform: translate(5%, 5%) scale(1.1); }
    75% { transform: translate(-3%, 3%) scale(1.05); }
  }

  .depth-layers {
    position: absolute;
    width: 100%;
    height: 100%;
  }

  .depth-circle {
    position: absolute;
    border-radius: 50%;
    filter: blur(80px);
    opacity: 0.4;
    animation: orbFloat 20s ease-in-out infinite;
  }

  .orb1 {
    width: 400px;
    height: 400px;
    background: radial-gradient(circle, rgba(0, 122, 255, 0.6) 0%, transparent 70%);
    top: 10%;
    left: 10%;
    animation-delay: 0s;
  }

  .orb2 {
    width: 500px;
    height: 500px;
    background: radial-gradient(circle, rgba(0, 81, 213, 0.5) 0%, transparent 70%);
    bottom: 10%;
    right: 10%;
    animation-delay: 10s;
  }

  @keyframes orbFloat {
    0%, 100% { transform: translate(0, 0) scale(1); }
    50% { transform: translate(50px, -50px) scale(1.1); }
  }

  .subconscious-particles {
    position: absolute;
    width: 100%;
    height: 100%;
  }

  .particle {
    position: absolute;
    width: 3px;
    height: 3px;
    background: rgba(0, 122, 255, 0.4);
    border-radius: 50%;
    animation: particleFloat 15s ease-in-out infinite;
    box-shadow: 0 0 6px rgba(0, 122, 255, 0.3);
  }

  .particle:nth-child(1) { top: 10%; left: 10%; animation-delay: 0s; }
  .particle:nth-child(2) { top: 20%; left: 80%; animation-delay: 2s; }
  .particle:nth-child(3) { top: 60%; left: 20%; animation-delay: 4s; }
  .particle:nth-child(4) { top: 80%; left: 70%; animation-delay: 6s; }
  .particle:nth-child(5) { top: 40%; left: 50%; animation-delay: 8s; }
  .particle:nth-child(6) { top: 30%; left: 30%; animation-delay: 10s; }
  .particle:nth-child(7) { top: 70%; left: 60%; animation-delay: 12s; }
  .particle:nth-child(8) { top: 50%; left: 90%; animation-delay: 14s; }

  @keyframes particleFloat {
    0%, 100% {
      transform: translateY(0) translateX(0);
      opacity: 0.4;
    }
    50% {
      transform: translateY(-30px) translateX(30px);
      opacity: 0.8;
    }
  }

  .court-circuit-hero {
    padding: 120px 20px 40px;
    text-align: center;
    position: relative;
    z-index: 1;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .newsletter-badge {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    padding: 12px 28px;
    background: rgba(22, 33, 62, 0.4);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(0, 122, 255, 0.3);
    border-radius: 50px;
    color: #007AFF;
    font-weight: 600;
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 24px;
    box-shadow: 0 8px 32px rgba(0, 122, 255, 0.1);
    transition: all 0.3s ease;
  }

  .newsletter-badge:hover {
    border-color: rgba(0, 122, 255, 0.5);
    box-shadow: 0 12px 40px rgba(0, 122, 255, 0.2);
    transform: translateY(-2px);
  }

  .newsletter-badge .zap-icon {
    color: #007AFF;
    flex-shrink: 0;
    animation: zapPulse 2s ease-in-out infinite;
  }

  @keyframes zapPulse {
    0%, 100% {
      opacity: 1;
      transform: scale(1);
    }
    50% {
      opacity: 0.8;
      transform: scale(1.1);
    }
  }

  .badges-row {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 16px;
    margin-top: 32px;
    margin-bottom: 0;
    flex-wrap: wrap;
  }

  .mini-badge {
    padding: 14px 28px;
    background: linear-gradient(135deg, rgba(0, 122, 255, 0.15) 0%, rgba(0, 81, 213, 0.2) 100%);
    backdrop-filter: blur(20px);
    border: 2px solid rgba(0, 122, 255, 0.5);
    border-radius: 50px;
    color: #007AFF;
    font-weight: 700;
    font-size: 0.95rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    box-shadow: 
      0 4px 20px rgba(0, 122, 255, 0.3),
      0 0 0 1px rgba(0, 122, 255, 0.1) inset,
      0 0 30px rgba(0, 122, 255, 0.15);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .mini-badge::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.5s;
  }

  .mini-badge:hover {
    border-color: rgba(0, 122, 255, 0.8);
    background: linear-gradient(135deg, rgba(0, 122, 255, 0.25) 0%, rgba(0, 81, 213, 0.3) 100%);
    box-shadow: 
      0 8px 40px rgba(0, 122, 255, 0.5),
      0 0 0 1px rgba(0, 122, 255, 0.2) inset,
      0 0 50px rgba(0, 122, 255, 0.3);
    transform: translateY(-3px) scale(1.05);
    color: #2D9AFF;
  }

  .mini-badge:hover::before {
    left: 100%;
  }

  .badge-separator {
    color: rgba(255, 255, 255, 0.4);
    font-size: 1.1rem;
    font-weight: 300;
    margin: 0 4px;
  }

  .hero-content {
    position: relative;
    z-index: 2;
    max-width: 1000px;
    margin: 0 auto;
  }

  .hero-content h1 {
    font-size: clamp(2.5rem, 6vw, 4.5rem);
    font-weight: 700;
    margin-bottom: 20px;
    line-height: 1.2;
    color: #ffffff;
    text-shadow: 0 0 30px rgba(0, 122, 255, 0.3);
  }

  .hero-content h1 .highlight-blue {
    color: #007AFF;
    background: linear-gradient(135deg, #2D9AFF 0%, #007AFF 50%, #4DA3FF 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .hero-subtitle {
    font-size: clamp(1.1rem, 2.5vw, 1.4rem);
    color: #a0a0a0;
    margin: 0;
    line-height: 1.6;
    max-width: 800px;
    margin-left: auto;
    margin-right: auto;
    margin-bottom: 0;
  }

  .hero-subtitle .highlight {
    color: #007AFF;
    font-weight: 700;
    background: linear-gradient(135deg, #007AFF 0%, #0051D5 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .hero-subtitle .coffee-icon {
    display: inline-block;
    vertical-align: middle;
    margin-left: 8px;
    color: #007AFF;
    animation: coffeeFloat 3s ease-in-out infinite;
  }

  @keyframes coffeeFloat {
    0%, 100% {
      transform: translateY(0) rotate(0deg);
    }
    50% {
      transform: translateY(-5px) rotate(5deg);
    }
  }

  .court-circuit-content {
    padding: 40px 20px 60px;
    position: relative;
    z-index: 1;
  }

  .container {
    max-width: 800px;
    margin: 0 auto;
  }

  .form-section {
    background: rgba(22, 33, 62, 0.4);
    border: 1px solid rgba(0, 122, 255, 0.3);
    border-radius: 24px;
    padding: 50px;
    backdrop-filter: blur(20px);
    box-shadow: 
      0 8px 32px rgba(0, 122, 255, 0.15),
      inset 0 1px 0 rgba(255, 255, 255, 0.1);
    position: relative;
    overflow: hidden;
  }

  .form-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(0, 122, 255, 0.5), transparent);
  }

  .form-section h2 {
    font-size: clamp(1.8rem, 4vw, 2.5rem);
    margin-bottom: 10px;
    color: #ffffff;
    text-align: center;
    font-weight: 700;
  }

  .form-description {
    text-align: center;
    color: #a0a0a0;
    margin-bottom: 40px;
    font-size: 1rem;
  }

  .inscription-form {
    display: flex;
    flex-direction: column;
    gap: 25px;
  }

  .form-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .form-group label {
    color: #ffffff;
    font-weight: 600;
    font-size: 0.95rem;
  }

  .form-group input {
    padding: 16px 22px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 14px;
    color: #ffffff;
    font-size: 1rem;
    transition: all 0.3s ease;
    font-family: inherit;
    backdrop-filter: blur(10px);
  }

  .form-group input::placeholder {
    color: rgba(255, 255, 255, 0.4);
  }

  .form-group input:focus {
    outline: none;
    border-color: #007AFF;
    background: rgba(255, 255, 255, 0.08);
    box-shadow: 
      0 0 0 3px rgba(0, 122, 255, 0.15),
      0 4px 12px rgba(0, 122, 255, 0.1);
    transform: translateY(-1px);
  }

  .submit-button {
    margin-top: 10px;
    padding: 20px 50px;
    background: linear-gradient(135deg, #007AFF 0%, #0051D5 50%, #007AFF 100%);
    background-size: 200% 200%;
    color: white;
    border: none;
    border-radius: 50px;
    font-size: 1.1rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 
      0 10px 30px rgba(0, 122, 255, 0.4),
      inset 0 1px 0 rgba(255, 255, 255, 0.2);
    position: relative;
    overflow: hidden;
  }

  .submit-button::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.5s;
  }

  .submit-button:hover {
    transform: translateY(-3px) scale(1.02);
    background-position: 100% 100%;
    box-shadow: 
      0 15px 40px rgba(0, 122, 255, 0.6),
      inset 0 1px 0 rgba(255, 255, 255, 0.3);
  }

  .submit-button:hover::before {
    left: 100%;
  }

  .submit-button:active {
    transform: translateY(-1px) scale(1);
  }

  .form-message {
    margin-top: 20px;
    padding: 15px;
    border-radius: 12px;
    text-align: center;
    font-weight: 500;
    display: none;
  }

  .form-message.success {
    display: block;
    background: rgba(34, 197, 94, 0.2);
    border: 1px solid rgba(34, 197, 94, 0.4);
    color: #4ade80;
  }

  .form-message.error {
    display: block;
    background: rgba(239, 68, 68, 0.2);
    border: 1px solid rgba(239, 68, 68, 0.4);
    color: #f87171;
  }

  @media (max-width: 768px) {
    .court-circuit-hero {
      padding: 100px 20px 30px;
    }

    .newsletter-badge {
      margin-bottom: 20px;
      padding: 10px 22px;
      font-size: 0.85rem;
    }

    .hero-content h1 {
      margin-bottom: 16px;
    }

    .hero-subtitle {
      font-size: clamp(1rem, 2vw, 1.2rem);
      line-height: 1.5;
    }

    .court-circuit-content {
      padding: 30px 20px 40px;
    }

    .form-section {
      padding: 30px 20px;
    }

    .submit-button {
      padding: 16px 30px;
      font-size: 1rem;
    }
  }
</style>

<script>
  // Compteur anim√© pour le nombre de lecteurs
  (function() {
    const counterElement = document.getElementById('counter');
    if (!counterElement) return;
    
    const targetValue = 10000;
    const duration = 2000; // 2 secondes
    const startTime = Date.now();
    const startValue = 0;
    
    function animateCounter() {
      const now = Date.now();
      const elapsed = now - startTime;
      const progress = Math.min(elapsed / duration, 1);
      
      // Easing function pour un effet plus naturel (ease-out)
      const easeOutQuart = 1 - Math.pow(1 - progress, 4);
      
      const currentValue = Math.floor(startValue + (targetValue - startValue) * easeOutQuart);
      
      // Formater avec espaces pour les milliers
      counterElement.textContent = currentValue.toLocaleString('fr-FR').replace(/\s/g, ' ');
      
      if (progress < 1) {
        requestAnimationFrame(animateCounter);
      } else {
        // S'assurer qu'on arrive exactement √† la valeur cible
        counterElement.textContent = targetValue.toLocaleString('fr-FR').replace(/\s/g, ' ');
      }
    }
    
    // D√©marrer l'animation apr√®s un petit d√©lai pour que la page soit charg√©e
    setTimeout(() => {
      requestAnimationFrame(animateCounter);
    }, 300);
  })();

  // Fonction pour d√©tecter le pays via API
  async function detectCountry() {
    try {
      const response = await fetch('https://ipapi.co/json/');
      const data = await response.json();
      return data.country_name || data.country || null;
    } catch (error) {
      console.error('Erreur d√©tection pays:', error);
      return null;
    }
  }

  const form = document.getElementById('inscriptionForm') as HTMLFormElement | null;
  const messageDiv = document.getElementById('formMessage') as HTMLElement | null;

  if (form && messageDiv) {
    form.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const formData = new FormData(form);
    const email = formData.get('email') as string;
    const prenom = formData.get('name') || formData.get('prenom');
    
    // D√©tecter le pays
    const country = await detectCountry();
    
    const data = {
      email: email,
      prenom: prenom,
      groupId: '173790390929851793',
      country: country
    };

    // R√©initialiser le message
    messageDiv.className = 'form-message';
    messageDiv.textContent = '';

    // D√©sactiver le bouton pendant l'envoi
    const submitButton = form.querySelector('.submit-button') as HTMLButtonElement | null;
    if (!submitButton) return;
    
    const buttonSpan = submitButton.querySelector('span') as HTMLElement | null;
    if (!buttonSpan) return;
    
    const originalButtonText = buttonSpan.textContent;
    submitButton.disabled = true;
    buttonSpan.textContent = 'Envoi en cours...';

    try {
      // V√©rifier si on est en local ou en production
      const isLocal = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
      
      if (isLocal) {
        // Simulation en local pour le d√©veloppement
        await new Promise(resolve => setTimeout(resolve, 1500));
        console.log('üß™ Mode local : Simulation d\'inscription', data);
        // Rediriger vers la page de succ√®s
        window.location.href = `/court-circuit-success`;
        return;
      }

      // Appel √† l'API MailerLite via Netlify Function
      const response = await fetch('/.netlify/functions/subscribe', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(data)
      });

      // R√©activer le bouton
      submitButton.disabled = false;
      buttonSpan.textContent = originalButtonText || 'Essaie maintenant';

      if (response.ok) {
        // Appel au webhook n8n pour d√©clencher l'email de bienvenue
        try {
          await fetch('https://n8n.sonnycourt.com/webhook/ebe808c2-e48d-4052-b229-a55e642f3841', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              email: formData.get('email'),
              name: formData.get('name') || formData.get('prenom')
            })
          });
        } catch (webhookError) {
          // On continue m√™me si le webhook √©choue (ne pas bloquer la redirection)
          console.error('Erreur webhook n8n:', webhookError);
        }
        
        // Rediriger vers la page de succ√®s
        window.location.href = `/court-circuit-success`;
      } else {
        const result = await response.json().catch(() => ({}));
        messageDiv.textContent = result.message || result.error || 'Une erreur est survenue. Veuillez r√©essayer.';
        messageDiv.classList.add('error');
      }
      
      // Masquer le message apr√®s 5 secondes
      setTimeout(() => {
        messageDiv.className = 'form-message';
        messageDiv.textContent = '';
      }, 5000);
      
    } catch (error) {
      console.error('Erreur lors de l\'inscription:', error);
      messageDiv.textContent = 'Une erreur est survenue. Veuillez r√©essayer.';
      messageDiv.classList.add('error');
      submitButton.disabled = false;
      buttonSpan.textContent = originalButtonText || 'Essaie maintenant';
    }
  });
  }
</script>


