[build]
command = "npm run build"
publish = "dist"

# Removed SPA catch-all rewrite that forced all 404s to the homepage.
# Netlify will now serve the generated 404.html from Astro.

# API redirects for tracking
[[redirects]]
  from = "/api/track"
  to = "/.netlify/functions/track"
  status = 200

[[redirects]]
  from = "/api/stats"
  to = "/.netlify/functions/stats"
  status = 200

[[redirects]]
  from = "/api/track-send"
  to = "/.netlify/functions/track-send"
  status = 200

[[redirects]]
  from = "/api/unsubscribe"
  to = "/.netlify/functions/unsubscribe"
  status = 200

[[redirects]]
  from = "/api/track-activity"
  to = "/.netlify/functions/track-activity"
  status = 200

[[redirects]]
  from = "/api/generate-email-pack"
  to = "/.netlify/functions/generate-email-pack"
  status = 200

# Redirections internes (priorité élevée)
[[redirects]]
  from = "/ssr-access"
  to = "/ssr-inscription"
  status = 301
  force = true

[[redirects]]
  from = "/ssr-access/"
  to = "/ssr-inscription"
  status = 301
  force = true

[build.processing]
skip_processing = false

[build.processing.css]
bundle = true
minify = true

[build.processing.js]
bundle = true
minify = true

[build.processing.images]
compress = true

[functions]
  [functions.daily-views-collector]
    background = true
    timeout = 900  # 15 minutes en secondes

  [functions."generate-email-pack"]
    timeout = 60
